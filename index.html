<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VOLT MASTER Panel</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <style>
        :root {
            --main-gold: #ffc107;
            --chat-blue: #2196f3;
            --break-green: #4caf50;
            --note-purple: #9c27b0;
            --dark-bg: #0f0f0f;
            --card-bg: rgba(255, 255, 255, 0.07);
            --text-main: #ffffff;
            --text-dim: #999999;
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-bg);
            color: var(--text-main);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            background-image: radial-gradient(circle at 50% 0%, #1a1a1a 0%, #000 100%);
            overflow: hidden;
        }

        .app-container { width: 90%; max-width: 380px; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .header { text-align: center; margin-bottom: 25px; cursor: pointer; user-select: none; }
        .header h1 { font-size: 26px; font-weight: 800; margin: 0; letter-spacing: 1px; }
        .header span { color: var(--main-gold); }

        .status-badge {
            display: inline-flex; align-items: center;
            background: rgba(255, 193, 7, 0.08);
            color: #fff;
            padding: 6px 18px; border-radius: 20px;
            font-size: 11px; margin-top: 8px;
            border: 1px solid rgba(255, 193, 7, 0.2);
            min-width: 180px; justify-content: center; gap: 8px;
            font-family: monospace;
        }

        .status-dot { width: 7px; height: 7px; border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.5); }

        .menu-grid { display: grid; gap: 12px; }
        .menu-item {
            background: var(--card-bg); border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 18px; padding: 20px; display: flex; align-items: center;
            cursor: pointer; transition: var(--transition);
        }
        .menu-item:hover { background: rgba(255, 255, 255, 0.12); border-color: var(--main-gold); transform: translateY(-3px); }

        .icon-box { width: 48px; height: 48px; border-radius: 14px; display: flex; justify-content: center; align-items: center; margin-right: 16px; flex-shrink: 0; font-size: 20px; }
        .icon-price { background: rgba(255, 193, 7, 0.15); color: var(--main-gold); }
        .icon-calc { background: rgba(255, 152, 0, 0.15); color: #ff9800; }
        .icon-note { background: rgba(156, 39, 176, 0.15); color: var(--note-purple); }
        .icon-chat { background: rgba(33, 150, 243, 0.15); color: var(--chat-blue); }
        .icon-break { background: rgba(76, 175, 80, 0.15); color: var(--break-green); }

        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô OVERLAY –î–õ–Ø –ü–û–õ–ù–û–ì–û –≠–ö–†–ê–ù–ê */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); z-index: 2000; display: none;
            flex-direction: column; animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .overlay-header { 
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; 
            background: #161616; border-bottom: 1px solid #333; flex-shrink: 0;
        }
        
        /* –≠—Ç–æ —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É "–ø–æ–ª–æ–≤–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞" */
        .overlay-body { flex-grow: 1; position: relative; overflow: hidden; }
        iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        .close-btn { background: none; border: none; color: #ff4444; font-size: 30px; cursor: pointer; }

        /* Admin Panel Styles */
        .admin-controls { background: #1a1a1a; padding: 18px; border-radius: 16px; margin-bottom: 15px; border: 1px solid #333; }
        .admin-input-group { display: flex; gap: 8px; margin: 10px 0; }
        .admin-input { flex: 1; background: #000; border: 1px solid #333; border-radius: 8px; color: #fff; padding: 10px; font-size: 14px; }
        .admin-add-btn { background: var(--main-gold); border: none; width: 45px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-danger { background: #ff4444; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 8px; width: 100%; font-size: 14px; text-transform: uppercase; }
        .btn-orange { background: #f57c00; }
        .tag { background: rgba(255,255,255,0.05); border: 1px solid #444; color: #ff4444; padding: 5px 10px; border-radius: 6px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .date-divider { background: #111; color: var(--main-gold); padding: 10px; font-size: 12px; font-weight: bold; margin-top: 20px; text-align: center; border-radius: 8px; border: 1px solid #222; }
        .log-item { padding: 15px 5px; border-bottom: 1px solid #1a1a1a; }
        .footer { text-align: center; margin-top: 30px; font-size: 10px; color: #444; letter-spacing: 2px; }
            /* --- –ö–Ω–æ–ø–∫–∞ WhatsApp --- */
        .whatsapp-float {
            position: fixed;
            width: 56px;
            height: 56px;
            bottom: 20px;
            right: 20px;
            background-color: #25d366;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            z-index: 1500; /* –í—ã—à–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
            transition: all 0.3s ease;
            animation: pulse-green 2s infinite;
            text-decoration: none;
        }

        .whatsapp-float:active { transform: scale(0.9); }

        .whatsapp-float img { width: 32px; height: 32px; }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∞ */
        .overlay[style*="display: flex"] ~ .whatsapp-float { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header" id="main-logo">
        <h1>VOLT<span>MASTER</span></h1>
        <div class="status-badge">
            <div class="status-dot" id="online-dot" style="background: #444;"></div>
            <span id="stats-display">–ó–ê–ì–†–£–ó–ö–ê...</span>
        </div>
    </div>

    <div class="menu-grid">
        <div class="menu-item" onclick="openApp('–ü—Ä–∞–π—Å-–ª–∏—Å—Ç', 'prais.html')">
            <div class="icon-box icon-price">üí∏</div>
            <div class="info"><h3>–ü—Ä–∞–π—Å-–ª–∏—Å—Ç</h3></div>
        </div>
        <div class="menu-item" onclick="openApp('–†–∞—Å—á–µ—Ç—ã', 'izmerenie.html')">
            <div class="icon-box icon-calc">‚ö°</div>
            <div class="info"><h3>–†–∞—Å—á–µ—Ç—ã</h3></div>
        </div>
        <div class="menu-item" onclick="openApp('–ó–∞–º–µ—Ç–∫–∏', 'zametka.html')">
            <div class="icon-box icon-note">üìù</div>
            <div class="info"><h3>–ó–∞–º–µ—Ç–∫–∏</h3></div>
        </div>
        <div class="menu-item" onclick="openApp('–ß–∞—Ç-–ø–æ–º–æ—â–Ω–∏–∫', 'signa.html')">
            <div class="icon-box icon-chat">üí¨</div>
            <div class="info"><h3>–ß–∞—Ç-–ø–æ–º–æ—â–Ω–∏–∫</h3></div>
        </div>
        <div class="menu-item" onclick="openApp('–ü–µ—Ä–µ–∫—É—Ä', 'igri.html')">
            <div class="icon-box icon-break">‚òï</div>
            <div class="info"><h3>–ü–µ—Ä–µ–∫—É—Ä</h3></div>
        </div>
    </div>
    <div class="footer">VOLT MASTER CLOUD 2026</div>
</div>

<div id="app-overlay" class="overlay">
    <div class="overlay-header">
        <span id="overlay-title" style="color:var(--main-gold); font-weight:bold;">App</span>
        <button class="close-btn" onclick="closeApp()">&times;</button>
    </div>
    <div class="overlay-body"><iframe id="app-frame"></iframe></div>
</div>

<div id="admin-overlay" class="overlay">
    <div class="overlay-header">
        <span style="color:var(--main-gold); font-weight:bold;">ADMIN PANEL</span>
        <button class="close-btn" onclick="closeAdmin()">&times;</button>
    </div>
    <div class="overlay-body" style="padding: 15px; overflow-y: auto; background: #0a0a0a;">
        <div class="admin-controls">
            <div id="admin-summary" style="font-size:16px; color:var(--main-gold); margin-bottom:15px; font-weight:bold;">–°–ï–ì–û–î–ù–Ø –ó–ê–®–õ–ò: <span id="today-count">0</span></div>
            <label style="color: var(--main-gold); font-size: 11px; display: block;">–ò–°–ö–õ–Æ–ß–ò–¢–¨ ID:</label>
            <div class="admin-input-group">
                <input type="text" id="exclude-input" class="admin-input" placeholder="ID">
                <button class="admin-add-btn" onclick="addExclusion()">+</button>
            </div>
            <div id="excluded-tags" style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px;"></div>
            <button class="btn-danger btn-orange" onclick="clearOnlyLogs()">–û–ß–ò–°–¢–ò–¢–¨ –õ–û–ì–ò</button>
            <button class="btn-danger" onclick="fullReset()">–ü–û–õ–ù–´–ô –°–ë–†–û–° –ë–ê–ó–´</button>
        </div>
        <div id="log-container"></div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://kalculator-8e345-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let myId = localStorage.getItem('user_id_2026') || "ID-" + Math.floor(Math.random() * 1000);
    localStorage.setItem('user_id_2026', myId);

    let totalReg = 0;
    let excludedIds = [];

    async function initTracker() {
        const statsEl = document.getElementById('stats-display');
        const dot = document.getElementById('online-dot');
        const now = new Date();
        const dateKey = now.toISOString().split('T')[0];
        const timeString = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });

        database.ref('excluded_list').on('value', snap => {
            excludedIds = Object.values(snap.val() || {});
            renderExclusionTags();
            
            if (!excludedIds.includes(myId)) {
                database.ref(`registered_users/${myId}`).set({ last_seen: firebase.database.ServerValue.TIMESTAMP });
                const visitRef = database.ref(`visits/${dateKey}/${myId}`);
                visitRef.transaction((curr) => {
                    if (curr) {
                        let h = curr.allTimes || curr.time || "";
                        if (!h.includes(timeString)) h += `, ${timeString}`;
                        return { ...curr, time: timeString, allTimes: h, count: (curr.count || 1) + 1, timestamp: firebase.database.ServerValue.TIMESTAMP };
                    }
                    return { userId: myId, time: timeString, allTimes: timeString, count: 1, timestamp: firebase.database.ServerValue.TIMESTAMP };
                });
            }
        });

        database.ref('registered_users').on('value', snap => {
    totalReg = snap.numChildren();
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É —Å—Ç–∞—Ç—É—Å–∞: —Ç–≤–æ–π ID –∏ –æ–±—â–µ–µ —á–∏—Å–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
    statsEl.innerHTML = `<span style="color:var(--main-gold)">${myId}</span> <span style="opacity:0.2; margin:0 5px;">|</span> –í–°–ï–ì–û: ${totalReg}`;
});

        database.ref(".info/connected").on("value", (snap) => {
            const online = snap.val() === true;
            dot.style.background = online ? "var(--main-gold)" : "#ff4444";
            dot.style.boxShadow = online ? "0 0 10px var(--main-gold)" : "0 0 10px #ff4444";
        });
    }

    function renderExclusionTags() {
        const container = document.getElementById('excluded-tags');
        if(!container) return;
        container.innerHTML = '';
        excludedIds.forEach(id => {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = `${id} <span>&times;</span>`;
            tag.onclick = () => removeExclusion(id);
            container.appendChild(tag);
        });
    }

    function addExclusion() {
        const val = document.getElementById('exclude-input').value.trim();
        if (val) {
            database.ref('excluded_list').push(val);
            document.getElementById('exclude-input').value = '';
        }
    }

    function removeExclusion(id) {
        database.ref('excluded_list').once('value', snap => {
            snap.forEach(child => {
                if (child.val() === id) child.ref.remove();
            });
        });
    }

    function loadLogs() {
        const dateKey = new Date().toISOString().split('T')[0];
        database.ref(`visits/${dateKey}`).on('value', snap => {
            let count = 0;
            snap.forEach(child => { if (!excludedIds.includes(child.key)) count++; });
            document.getElementById('today-count').innerText = count;
        });

        database.ref('visits').on('value', snap => {
            const container = document.getElementById('log-container');
            container.innerHTML = '';
            const all = snap.val() || {};
            Object.keys(all).sort().reverse().forEach(date => {
                const dayVisits = Object.values(all[date]).filter(v => !excludedIds.includes(v.userId)).sort((a,b) => b.timestamp - a.timestamp);
                if(dayVisits.length > 0) {
                    container.innerHTML += `<div class="date-divider">--- ${date} ---</div>`;
                    dayVisits.forEach(v => {
                        container.innerHTML += `
                            <div class="log-item">
                                <div style="display:flex; justify-content:space-between; font-size:14px;">
                                    <b>${v.userId} <span style="color:var(--main-gold); font-size:11px;">x${v.count || 1}</span></b>
                                    <span style="color:var(--main-gold); font-size:12px;">${v.time}</span>
                                </div>
                                <div style="color:#555; font-size:10px; margin-top:5px;">‚Ä¢ ${v.allTimes}</div>
                            </div>`;
                    });
                }
            });
        });
    }

    function clearOnlyLogs() { if(confirm("–£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞—Ö–æ–¥–æ–≤?")) database.ref('visits').remove(); }
    function fullReset() { if(confirm("–£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ?")) { database.ref().remove(); location.reload(); } }
    function openAdmin() { document.getElementById('admin-overlay').style.display = 'flex'; loadLogs(); }
    function closeAdmin() { document.getElementById('admin-overlay').style.display = 'none'; database.ref('visits').off(); }

    function openApp(name, url) { 
        document.getElementById('overlay-title').innerText = name; 
        document.getElementById('app-frame').src = url; 
        document.getElementById('app-overlay').style.display = 'flex'; 
    }
    
    function closeApp() { 
        document.getElementById('app-overlay').style.display = 'none'; 
        document.getElementById('app-frame').src = 'about:blank'; 
    }

    let clicks = 0;
    document.getElementById('main-logo').onclick = () => {
        clicks++;
        if(clicks === 3) { if(prompt("–ü–∞—Ä–æ–ª—å:") === "Gazik0303") openAdmin(); clicks = 0; }
        setTimeout(() => clicks = 0, 1000);
    };

    document.addEventListener('DOMContentLoaded', initTracker);
</script>
<a href="https://chat.whatsapp.com/E10FzUdV9YLHem5KCVAQtQ?mode=gi_t" class="whatsapp-float" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA">
</a>

</body>
</html>